apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# This tells Kustomize to use the upstream olm.yaml as the base
resources:
  - https://raw.githubusercontent.com/operator-framework/operator-lifecycle-manager/v0.32.0/deploy/upstream/quickstart/olm.yaml

# These are the same patches as before, but now applied by Kustomize
patches:
  - patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: quay.io/operator-framework/olm:v0.32.0
    target:
      kind: Deployment
      name: olm-operator
  - patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/image
        value: quay.io/operator-framework/olm:v0.32.0
      - op: replace
        path: /spec/template/spec/containers/0/args/2
        value: -configmapServerImage=quay.io/operator-framework/configmap-operator-registry:v0.32.0
      - op: replace
        path: /spec/template/spec/containers/0/args/4
        value: quay.io/operator-framework/olm:v0.32.0
    target:
      kind: Deployment
      name: catalog-operator
  - patch: |-
      - op: replace
        path: /spec/install/spec/deployments/0/spec/template/spec/containers/0/image
        value: quay.io/operator-framework/olm:v0.32.0
    target:
      group: operators.coreos.com
      kind: ClusterServiceVersion
      name: packageserver

