# values.yaml

# Set a predictable name so the chart finds the objects we created.
fullnameOverride: step-certificates

replicaCount: 3

# We are NOT using inject or bootstrap. They MUST be disabled.
inject:
  enabled: false
bootstrap:
  enabled: false

# This block is now the main configuration.
# It tells the chart to use the ConfigMaps and Secrets we just created.
existingSecrets:
  enabled: true
  ca: true
  # The following are false because we used ConfigMaps, not Secrets, for them.
  certsAsSecret: false
  configAsSecret: false

# This top-level `ca` block configures the deployment runtime.
ca:
  # Inject database credentials into the pod's environment.
  env:
    - name: PGHOST
      valueFrom:
        secretKeyRef:
          name: step-ca-db-datasource
          key: host
    - name: PGPORT
      valueFrom:
        secretKeyRef:
          name: step-ca-db-datasource
          key: port
    - name: PGDATABASE
      valueFrom:
        secretKeyRef:
          name: step-ca-db-datasource
          key: database
    - name: PGUSER
      valueFrom:
        secretKeyRef:
          name: step-ca-db-datasource
          key: user
    - name: PGPASSWORD
      valueFrom:
        secretKeyRef:
          name: step-ca-db-datasource
          key: password
  # Disable the built-in persistent database.
  db:
    persistent: false

# Configure the service port.
service:
  targetPort: 9000
