# This patch targets the 'openbao-auth-config' Application and injects
# another patch into its 'kustomize.patches' field. This inner patch
# configures the VaultAuth sub-resource with the correct values for this cluster.
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: openbao-auth-config
spec:
  source:
    kustomize:
      patches:
        - patch: |-
            # This is the patch that will be applied to the VaultAuth resource
            apiVersion: secrets.hashicorp.com/v1beta1
            kind: VaultAuth
            metadata:
              name: operator-auth
            spec:
              mount: kubernetes_cluster_mc
              kubernetes:
                role: openbao-secrets-operator
          target:
            # This targets the VaultAuth resource generated by the application
            kind: VaultAuth
            name: operator-auth
