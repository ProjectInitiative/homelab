# clusters/cc.yaml
name: cc
server: https://kubernetes.default.svc
project: cc-bootstrap
argoNamespace: argocd-cc
vaultMount: kubernetes_cluster_cc
apps:
  - name: local-path-provisioner
    namespace: local-path-storage
    patch: ""
    patchTarget: {}
  - name: admin-access
    namespace: kube-system
  - name: tailscale-operator
    namespace: tailscale
    patchTarget: {}
  - name: cert-manager
    namespace: cert-manager
  - name: openbao-auth-config
    namespace: kube-system
    patch: |-
      apiVersion: secrets.hashicorp.com/v1beta1
      kind: VaultAuth
      metadata:
        name: operator-auth
      spec:
        mount: kubernetes_cluster_cc
        kubernetes:
          role: openbao-secrets-operator
    patchTarget:
      kind: VaultAuth
      name: operator-auth
  - name: openbao-secrets-operator
    namespace: openbao-secrets-operator
    helm_values: |
      vault:
        address: http://openbao.openbao:8200
        auth:
          method: kubernetes
          path: kubernetes_cluster_cc
          role: openbao-secrets-operator
  - name: tailscale-proxy-groups
    namespace: tailscale
    patch: |-
      - op: replace
        path: /metadata/name
        value: control-cluster-proxy
      - op: replace
        path: /spec/tags/0
        value: tag:k8s
    patchTarget:
      kind: ProxyGroup
      name: placeholder-name
  - name: dnsutils
    namespace: dnsutils
  - name: prometheus-operator-crds
    namespace: monitoring
  - name: grafana-alloy
    namespace: monitoring
  - name: observability
    namespace: monitoring
  - name: karmada-operator
    namespace: karmada-system
  - name: karmada-instance
    namespace: karmada-system
    patch: |-
      apiVersion: operator.karmada.io/v1alpha1
      kind: Karmada
      metadata:
        name: karmada
      spec:
        components:
          etcd:
            local:
              replicas: 5
              volumeData:
                volumeClaim:
                  spec:
                    accessModes:
                      - ReadWriteOnce
                    storageClassName: local-path-sticky
                    resources:
                      requests:
                        storage: 5Gi
          karmadaAPIServer:
            replicas: 2
          karmadaAggregatedAPIServer:
            replicas: 2
          karmadaControllerManager:
            replicas: 2
          karmadaScheduler:
            replicas: 2
          karmadaWebhook:
            replicas: 2
          karmadaSearch:
            replicas: 2
    patchTarget:
      kind: Karmada
      name: karmada
  - name: karmada-member
    namespace: kube-system
  - name: submariner-k8s-broker
    namespace: submariner-k8s-broker
  - name: submariner-operator
    namespace: submariner-operator
    helm_values: |
      submariner:
        clusterID: "cc"
        clusterCIDR: "10.42.0.0/16"
        serviceCIDR: "10.43.0.0/16"
        brokerK8sSecret: "submariner-broker-info"
        brokerK8sApiServer: "https://kubernetes.default.svc:443"
